<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SPS</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="logo">
                    <h1>SPS</h1>
                    <span class="logo-subtitle">Dashboard</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="/index.html" class="nav-link">Home</a></li>
                    <li id="nav-logout-item" style="display: none;"><a href="#" class="nav-link" onclick="authManager.logout(); return false;">Logout</a></li>
                    <li><a href="/dashboard.html" class="nav-link active">Dashboard</a></li>
                    <li><a href="/inventory.html" class="nav-link">Inventory</a></li>
                    <li><a href="/pantry.html" class="nav-link">Pantry</a></li>
                    <li><a href="/garden.html" class="nav-link">Garden</a></li>
                    <li class="nav-dropdown">
                        <a href="/videos.html" class="nav-link" data-active-paths="/videos.html,/pictures.html">Media ‚ñæ</a>
                        <ul class="dropdown-menu">
                            <li><a href="/videos.html">Videos</a></li>
                            <li><a href="/pictures.html">Pictures</a></li>
                        </ul>
                    </li>
                    <li><a href="/kiwix.html" class="nav-link">Kiwix</a></li>
                    <li class="nav-dropdown"><a href="/gps.html" class="nav-link" data-active-paths="/gps.html,/osm-sync.html">Map ‚ñæ</a><ul class="dropdown-menu"><li><a href="/gps.html">Map View</a></li><li><a href="/osm-sync.html">Sync Maps</a></li></ul></li>
                    <li class="nav-dropdown">
                        <a href="#" class="nav-link" data-active-paths="/familyprofile.html,/energy.html,/medical.html,/settings.html,/calculations.html,/simulation.html">Tools ‚ñæ</a>
                        <ul class="dropdown-menu">
                            <li><a href="/familyprofile.html">Family Profile</a></li>
                            <li><a href="/calculations.html">Calculations</a></li>
                            <li><a href="/simulation.html">Simulation & Planning</a></li>
                            <li><a href="/energy.html">Energy Calculator</a></li>
                            <li><a href="/medical.html">Medical Guide</a></li>
                            <li><a href="/settings.html">Settings</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="nav-right">
                    <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <div id="user-section" class="user-section" style="display: none;">
                        <span id="user-name"></span>
                        <button onclick="authManager.logout()" class="btn btn-secondary btn-sm">Logout</button>
                    </div>
                    <div id="auth-buttons" style="display: flex; gap: 10px;">
                        <button onclick="authManager.showLoginModal()" class="btn btn-primary btn-sm">Login</button>
                        <button onclick="authManager.showRegisterModal()" class="btn btn-secondary btn-sm">Register</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="dashboard-main">
        <div class="container">
            <h1 class="dashboard-title">My Preparedness Dashboard</h1>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-info">
                        <h3 id="total-items">0</h3>
                        <p>Total Items</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-info">
                        <h3 id="expiring-soon">0</h3>
                        <p>Expiring Soon</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìâ</div>
                    <div class="stat-info">
                        <h3 id="low-stock">0</h3>
                        <p>Low Stock</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-info">
                        <h3 id="total-value">$0</h3>
                        <p>Total Value</p>
                    </div>
                </div>
            </div>

            <!-- Inventory Overview Section -->
            <section id="inventory" class="dashboard-section">
                <div class="section-header">
                    <h2>Inventory Overview</h2>
                    <a href="/inventory.html" class="btn btn-outline">Manage Inventory</a>
                </div>

                <!-- Inventory Charts Grid -->
                <div class="inventory-charts-grid">
                    <div class="chart-card">
                        <h3>Items by Category</h3>
                        <div class="chart-container">
                            <canvas id="inventory-category-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Items Needing Attention</h3>
                        <div id="inventory-attention-list" class="attention-list">
                            <p class="empty-text">Loading...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pantry Overview Section -->
            <section id="pantry-overview" class="dashboard-section">
                <div class="section-header">
                    <h2>Food Pantry Overview</h2>
                    <a href="/pantry.html" class="btn btn-outline">View Full Pantry</a>
                </div>

                <!-- Pantry Stats -->
                <div class="pantry-stats-grid">
                    <div class="stat-card pantry-stat">
                        <div class="stat-icon">üçΩÔ∏è</div>
                        <div class="stat-info">
                            <h3 id="pantry-total-items">0</h3>
                            <p>Food Items</p>
                        </div>
                    </div>
                    <div class="stat-card pantry-stat">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-info">
                            <h3 id="pantry-total-calories">0</h3>
                            <p>Total Calories</p>
                        </div>
                    </div>
                    <div class="stat-card pantry-stat">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-info">
                            <h3 id="pantry-days-supply">0</h3>
                            <p>Days of Supply</p>
                        </div>
                    </div>
                    <a href="/pantry.html?tab=expiring&days=7" class="stat-card pantry-stat expiring-7 clickable">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-info">
                            <h3 id="pantry-expiring-7">0</h3>
                            <p>Expiring 7 Days</p>
                        </div>
                    </a>
                    <a href="/pantry.html?tab=expiring&days=30" class="stat-card pantry-stat expiring-30 clickable">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-info">
                            <h3 id="pantry-expiring-30">0</h3>
                            <p>Expiring 30 Days</p>
                        </div>
                    </a>
                    <a href="/pantry.html?tab=expiring&days=90" class="stat-card pantry-stat expiring-90 clickable">
                        <div class="stat-icon">üìÜ</div>
                        <div class="stat-info">
                            <h3 id="pantry-expiring-90">0</h3>
                            <p>Expiring 90 Days</p>
                        </div>
                    </a>
                </div>

                <!-- Pantry Charts -->
                <div class="pantry-charts-grid">
                    <div class="chart-card">
                        <h3>Calories by Category</h3>
                        <div class="chart-container">
                            <canvas id="pantry-category-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Macronutrient Balance</h3>
                        <div class="chart-container">
                            <canvas id="pantry-macros-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Expiring Items Preview -->
                <div class="expiring-preview">
                    <h3>Items Expiring Soon</h3>
                    <div id="dashboard-expiring-list" class="expiring-items-list">
                        <p class="empty-text">No items expiring soon</p>
                    </div>
                </div>
            </section>

            <!-- System Monitoring Section -->
            <section id="system-monitor" class="dashboard-section">
                <div class="section-header">
                    <h2>System Status</h2>
                    <button class="btn btn-outline btn-sm" onclick="loadSystemInfo()">Refresh</button>
                </div>

                <div class="system-stats-grid">
                    <div class="system-card">
                        <div class="system-card-header">
                            <span class="system-icon">üñ•Ô∏è</span>
                            <h4>CPU</h4>
                        </div>
                        <div class="system-card-body">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="cpu-bar" style="width: 0%"></div>
                            </div>
                            <div class="system-stats">
                                <span id="cpu-percent">0%</span>
                                <span id="cpu-cores" class="stat-secondary">0 cores</span>
                            </div>
                            <div class="stat-detail" id="cpu-model">Loading...</div>
                        </div>
                    </div>

                    <div class="system-card">
                        <div class="system-card-header">
                            <span class="system-icon">üíæ</span>
                            <h4>Memory</h4>
                        </div>
                        <div class="system-card-body">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="memory-bar" style="width: 0%"></div>
                            </div>
                            <div class="system-stats">
                                <span id="memory-percent">0%</span>
                                <span id="memory-used" class="stat-secondary">0 / 0 GB</span>
                            </div>
                        </div>
                    </div>

                    <div class="system-card">
                        <div class="system-card-header">
                            <span class="system-icon">üíø</span>
                            <h4>Disk</h4>
                        </div>
                        <div class="system-card-body">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="disk-bar" style="width: 0%"></div>
                            </div>
                            <div class="system-stats">
                                <span id="disk-percent">0%</span>
                            </div>
                            <div class="disk-details">
                                <span class="disk-stat"><span class="disk-label">Used:</span> <span id="disk-used">0 GB</span></span>
                                <span class="disk-stat"><span class="disk-label">Free:</span> <span id="disk-free">0 GB</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="system-card">
                        <div class="system-card-header">
                            <span class="system-icon">‚è±Ô∏è</span>
                            <h4>Uptime</h4>
                        </div>
                        <div class="system-card-body">
                            <div class="uptime-display" id="system-uptime">--</div>
                            <div class="stat-detail" id="system-hostname">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- PM2 Processes -->
                <div class="pm2-processes">
                    <h4>Services</h4>
                    <div class="process-grid" id="pm2-process-list">
                        <p class="empty-text">Loading services...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="login-modal" class="modal auth-modal">
        <div class="modal-content modal-small">
            <span class="close" onclick="authManager.hideModals()">&times;</span>
            <h2>Login to SPS</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username">Username or Email</label>
                    <input type="text" id="login-username" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <div id="login-error" class="error-message" style="display: none;"></div>
                <button type="submit" class="btn btn-primary btn-block">Login</button>
            </form>
            <p class="modal-footer">
                Don't have an account? <a href="#" onclick="authManager.hideModals(); authManager.showRegisterModal();">Register</a>
            </p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal auth-modal">
        <div class="modal-content modal-small">
            <span class="close" onclick="authManager.hideModals()">&times;</span>
            <h2>Create Account</h2>
            <form id="register-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="register-firstname">First Name</label>
                        <input type="text" id="register-firstname">
                    </div>
                    <div class="form-group">
                        <label for="register-lastname">Last Name</label>
                        <input type="text" id="register-lastname">
                    </div>
                </div>
                <div class="form-group">
                    <label for="register-username">Username *</label>
                    <input type="text" id="register-username" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email *</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password *</label>
                    <input type="password" id="register-password" required minlength="8">
                </div>
                <div id="register-error" class="error-message" style="display: none;"></div>
                <button type="submit" class="btn btn-primary btn-block">Create Account</button>
            </form>
            <p class="modal-footer">
                Already have an account? <a href="#" onclick="authManager.hideModals(); authManager.showLoginModal();">Login</a>
            </p>
        </div>
    </div>

    <script src="js/theme-toggle.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>
